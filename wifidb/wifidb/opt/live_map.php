<?php
/*
Database.inc.php, holds the database interactive functions.
Copyright (C) 2011 Phil Ferland

This program is free software; you can redistribute it and/or modify it under the terms
of the GNU General Public License as published by the Free Software Foundation; either
version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.

ou should have received a copy of the GNU General Public License along with this program;
if not, write to the

   Free Software Foundation, Inc.,
   59 Temple Place, Suite 330,
   Boston, MA 02111-1307 USA
*/
define("SWITCH_SCREEN", "HTML");
define("SWITCH_EXTRAS", "");
include('../lib/init.inc.php');

$ft_start = microtime(1);
$startdate="02-Oct-2011";
$lastedit="02-Oct-2011";

$n=0;
$maps_compile_a = array();
$sql = "SELECT ssid, sectype, lat, `long` FROM `live_aps`";
$result = $dbcore->sql->conn->query($sql, $conn);
while($array = $result->fetch(2))
{
    $ssid = $array['ssid'];
    $sig_exp = explode("|", $array['sig']);
    if($array['lat'] == "0000.0000")
    {
        $nn++;
        continue;
    }

    $lat = $dbcore->convert_dm_dd($array_gps['lat']);
    $long = $dbcore->convert_dm_dd($array_gps['long']);
    if($lat == "0")
    {
        $nn++;
        continue;
    }

    switch($array['sectype'])
    {
        case 1:
            $img = "open";
            break;
        case 2:
            $img = "wep";
            break;
        case 3:
            $img = "secure";
            break;
    }
    $maps_compile_a[] = $img."
                       var myLatLng$n = new google.maps.LatLng($lat, $long);
                       var beachMarker$n = new google.maps.Marker({position: myLatLng$n, map: map, icon: $img, title: \"$ssid\"});\r\n";
    $n++;
}
#var_dump($maps_compile_a);
$maps_compile = implode("", $maps_compile_a);
$ft_stop = microtime(1);
echo $ft_stop-$ft_start."\r\n";
echo $n."\r\n".$nn;
#exit();
?>
<html>
    <head>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=yes" />
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
        <link href="https://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
        <style type="text/css">
            .maps_label {background-color:#ffffff;font-weight:bold;border:2px #006699 solid;}
        </style>
        <script type="text/javascript">
            function initialize()
            {
                var myOptions = {
                  zoom: 16,
                  center: new google.maps.LatLng(<?php echo $lat; ?>, <?php echo $long; ?>),
                  mapTypeId: google.maps.MapTypeId.ROADMAP
                }
                var open = 'http://vistumbler.sourceforge.net/images/program-images/open.png';
                var wep = 'http://vistumbler.sourceforge.net/images/program-images/secure-wep.png';
                var secure = 'http://vistumbler.sourceforge.net/images/program-images/secure.png';
                var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
                <?php
                echo $maps_compile;
                ?>
            }
            window.onload = initialize;
        </script>
    </head>
    <body>
        <div style="width:100%;height:100%;" id="map_canvas"></div>
    </body>
</html>